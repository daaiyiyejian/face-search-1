<!DOCTYPE html>
<html lang="en" ng-app="facesearch" class="fill-height">
<head>
    <meta charset="UTF-8">
    <title>Face Search</title>
    <link rel="stylesheet" type="text/css" href="../styles/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="../scripts/angular.min.js"></script>
    <script src="../scripts/jquery-3.1.1.min.js"></script>
    <script src="../styles/bootstrap/js/bootstrap.min.js"></script>
    <script src="../scripts/ui-bootstrap-tpls-2.3.2.min.js"></script>
    <script src="../scripts/ng-file-upload.min.js"></script> <!-- file uploader -->
    <script src="d3.js"></script>
    <script src="plot.js"></script>
    <script src="thumbnail.js"></script>
    <script src="face-search.js"></script>
</head>
<body class="fill-height">

<div ng-controller="faceSearchController" class="container-fluid fill-height">

    <!-- Input Area -->
    <div class="row fill-height">

        <!-- Left Panel -->
        <div class="col-lg-3 fill-height" style="display: flex; flex-direction: column; padding-top: 10px; padding-bottom: 10px">

            <!-- logo -->
            <img src="logo.png" style="max-width: 100%; padding-bottom: 10px">

            <div class="rounded-panel" style="flex-grow: 1">
                <form>
                    <p>
                        <label>Upload an image:</label>
                        <input type="file" ngf-select ng-model="formModel.file" name="file"
                               accept="image/*" ngf-max-size="19MB" required ng-change="upload()" ng-disabled="isUploading">
                    </p>
                    <p>
                        <label>Or provide image URL:</label>
                        <input type="text" ng-model="formModel.imageURL"/>
                        <button class="btn btn-primary btn-xs" ng-disabled="isUploading" ng-click="upload()">Upload</button>
                    </p>
                </form>

                <div ng-if="imageFilename" ng-repeat="path in [imageFilename]" style="flex-grow: 1">
                    <p>Draw bounding box:</p>
                    <plot image-path="{{uploadImageDir}}/{{path}}" plot-api="plotAPI"></plot>
                    <button class="btn btn-primary btn-xs" ng-click="resetImage()">Reset</button>
                    <button class="btn btn-primary btn-xs" ng-click="addImage()">Add</button>
                </div>
            </div>
        </div> <!-- end of left panel -->

        <!-- Right panel -->
        <div class="col-lg-9 fill-height">

            <!-- image list -->
            <div class="images-panel">
                <div ng-repeat="(path, box) in images" style="position:relative;display: inline-block;">
                    <thumbnail class="thumbnail"
                               img-src="{{uploadImageDir}}/{{path}}"
                               box-x="box.face_x"
                               box-y="box.face_y"
                               box-width="box.face_width"
                               box-height="box.face_height"
                               box=true
                               display-height="200"
                                display-width="200">
                    </thumbnail>
                    <button class="btn thumbnail-close" ng-click="removeImage(path)">x</button>
                </div>
            </div> <!-- end of image list -->

            <button class="btn btn-primary" ng-click="search()" ng-disabled="imageCount == 0">Search</button>

            <!-- result -->
            <div id="result-table" class="result-panel" ng-if="result">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-heading">
                    <tr>
                        <th style="width: 1px; white-space: nowrap; align-content: center">Template ID</th>
                        <th style="width: 1px; white-space: nowrap">Similarity</th>
                        <th>Images</th>
                    </tr>
                    </thead>

                    <!-- rows -->
                    <tbody>
                    <tr class="table-row" ng-repeat="r in result track by $index">
                        <td align="center">{{r.template_id}}</td>
                        <td align="center">{{r.similarity}}</td>
                        <td>
                            <thumbnail ng-repeat="template in gallery[r.template_id] | limitTo: 5"
                                       class="img-thumbnail"
                                       img-src="{{galleryImageDir}}{{template.FILENAME}}"
                                       box-x="template.FACE_X"
                                       box-y="template.FACE_Y"
                                       box-width="template.FACE_WIDTH"
                                       box-height="template.FACE_HEIGHT"
                                       display-width="100"
                                       display-height="100"
                                       crop=true
                                       style="vertical-align: bottom; cursor: pointer"></thumbnail>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div> <!-- end of result -->

        </div> <!-- end of right panel -->
    </div> <!-- end of input area -->
</div> <!-- end of controller -->

</body>
</html>